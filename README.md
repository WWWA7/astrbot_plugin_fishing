![:astrbot_plugin_fish](https://count.getloli.com/@:astrbot_plugin_fish?theme=capoo-1)

# AstrBot 钓鱼插件

一个功能齐全的钓鱼游戏系统插件，为您的机器人添加有趣的钓鱼休闲游戏。

[![AGPL-3.0 License](https://img.shields.io/badge/License-AGPL--3.0-blue.svg)](https://opensource.org/licenses/AGPL-3.0)
[![Python](https://img.shields.io/badge/Python-3.8+-green.svg)](https://python.org)
[![AstrBot](https://img.shields.io/badge/AstrBot-Plugin-orange.svg)](https://github.com/astrbot/astrbot)

## ✨ 功能特点

- **完整的钓鱼游戏系统**：多种鱼类和稀有度，丰富的钓鱼体验
- **可扩展的稀有度系统**：支持1-10星稀有度，新增6-10星颜色映射
- **全新商店系统**：多商店类型（普通、高级、限时），支持复杂商品机制和成本组合
- **智能区域访问控制**：通行证机制，不同区域有不同的进入要求
- **装备精炼系统**：鱼竿、饰品可精炼升级，提升属性加成
- **装备保护系统**：锁定功能保护高级装备，防止意外操作
- **道具系统**：丰富的道具效果，包括通行证、护符、增益道具等
- **经济系统**：金币、高级货币双货币体系，市场交易系统
- **抽卡系统**：多种卡池，限时活动，十连保底机制
- **社交功能**：排行榜、偷鱼、成就称号系统
- **后台管理**：Web管理界面，支持数据导入导出，灵活配置游戏参数
- **线程安全优化**：DatabaseConnectionManager提供稳定的数据库连接管理
- **消息保护机制**：自动截断超长消息，防止显示问题
- **数据兼容**：支持导入1.4.6版本数据，平滑升级体验

## 🔧 安装方法

1. 将此插件放入 `data/plugins/` 目录。或者安装插件时→从链接安装→本项目地址
2. 重启 AstrBot 或使用插件管理命令加载插件

## 💡 未来计划

如果你有什么想法，欢迎提交issue！期待您天马行空的想法

### 🤝 开发计划

- [x] 分离成就模块，以便于未来拓展
- [x] 丰富图鉴类命令 ➞　图片输出的图鉴命令
- [x] 将部分输出结果改写成输出图片
- [x] 钓鱼区域功能扩展
- [x] 更多经济系统
- [x] 重构商店系统
- [x] 扩展背包，增加道具栏
- [x] 装备保护系统（锁定功能）
- [x] 更多社交玩法

#### 📋 当前开发状态

**2.0版本已完成所有主要功能开发**，目前没有新的功能开发计划。

**后续版本将专注于：**
- 🐛 **Bug修复**：修复用户反馈的问题和已知bug
- 🔧 **性能优化**：提升系统稳定性和响应速度
- 📝 **代码优化**：改进代码质量和可维护性
- 🛡️ **安全加固**：增强系统安全性

如果您有功能建议或发现问题，欢迎在 [Issues](https://github.com/xxlemon-io/astrbot_plugin_fishing/issues) 中提出！
 
## 📦 更新记录

#### v2.0.0 (商店系统重构 - 重大更新)

- **全新商店系统**：重构为多商店类型系统，支持普通商店、高级商店、限时商店
- **复杂商品机制**：支持多种成本类型（金币、高级货币、鱼竿、饰品、道具）和奖励机制
- **线程安全优化**：新增DatabaseConnectionManager，提供线程安全的数据库连接管理
- **商店商品扩展**：支持鱼竿和饰品作为商店商品，丰富商品类型
- **Web管理增强**：新增商店管理界面，支持商店创建、商品管理、库存控制
- **时间控制功能**：支持商店营业时间、每日营业时间、限时商品等时间控制
- **限购机制**：支持每人限购、每日限购等购买限制
- **成本分组系统**：支持复杂的成本组合逻辑（AND/OR关系）
- **显示代码系统**：鱼竿和饰品支持Base36编码的短代码显示，便于用户识别和管理
  - 短代码显示：装备实例现在支持Base36编码的短代码显示
  - 便于识别：用户可以通过短代码快速识别和管理装备
  - 向下兼容：保持原有数字ID的同时，提供更友好的显示方式
  - 自动生成：系统自动为所有装备实例生成唯一的显示代码
- **稀有度颜色扩展**：新增6-10星稀有度颜色映射，支持更高稀有度显示
- **擦弹功能优化**：改进消息格式，添加抑制通知，提升用户体验
- **消息截断保护**：防止消息过长导致显示问题，自动截断超长内容
- **批量道具发放**：管理员可给所有用户批量发放指定道具
- **数据迁移**：平滑升级，保持数据兼容性

#### v1.7.5 (图鉴系统重构)

- **图鉴图片化**：文本图鉴改为美观图片展示，每页显示20个鱼类
- **背包风格设计**：渐变背景、圆角设计、用户头像集成
- **数据优化**：新增统计表提升性能，自动清理历史数据
- **视觉效果**：丰富色彩搭配，文本符号增强，布局优化

#### v1.7.4 (打开全部钱袋功能)

  - 更新 `/打开全部钱袋` 命令，提升用户体验

#### v1.7.3 (架构重构)

- 统一命令注册方式，优化代码结构
- 新增命令别名，提升用户体验
- 保持向后兼容，不改变游戏逻辑

#### v1.7.2 (反制道具系统)

- 新增破灵符、驱灵香、暗影斗篷等反制道具
- 平衡海灵守护机制，增加策略性

#### v1.7.1 (稀有度调整)

- 稀有鱼范围调整为4星+
- 优化配额系统，提升游戏平衡性

#### v1.7.0 (精炼系统升级)

- 新增降级失败机制，三种失败结果
- 优化锁定装备功能，修复设计失误
- 调整精炼成功率，提升挑战性

#### v1.6.9 (扩展稀有度系统)

- 移除5星限制，支持任意星级鱼类
- 后台支持高星级鱼类管理

#### v1.6.8 (装备保护功能)

- 新增装备锁定系统，防止意外操作
- 新增砸锅卖铁功能，一键清仓

#### v1.6.7 (安全更新)

- 后台管理地址改为localhost，提升安全性

#### v1.6.6 (紧急修复)

- 修复饰品/鱼竿无限卖出Bug
- 修复批量使用道具消息刷屏问题

#### v1.6.5 (钓鱼区域系统)

- 智能通行证机制，自动消耗系统
- 后台管理配置，用户体验提升

#### v1.6.4 (道具系统)

- 新增守护海灵、时运沙漏道具
- 擦弹玩法升级，御神籤风格占卜

#### v1.6.3 (精炼系统)

- 修复精炼金币提示问题
- 统一精炼失败机制
- 新增精炼护符系统，保护装备精炼
- 管理命令精简，新增同步道具功能

#### v1.6.2 (市场系统)

- 重构出售定价系统，支持精炼等级乘数
- 优化批量出售功能

#### v1.6.1 (代码重构)

- AI代码审计重构，性能优化
- 异步改造，提升高并发性能
- 健壮性增强，路径管理优化
- 安全加固，代码去重

#### v1.4.6 - v.1.6.0

- 扩展了高级货币/钻石/星石功能
- 增加了道具系统，现在你有更多机会偷鱼和擦弹！
- 新增了每日免费一抽，签到自动抽取
- 新增了背包功能，使用/背包来查看所有物品
- 更好的精炼系统，新增了耐久和毁坏机制。使用/精炼命令来查看新特性
- 新增了后台管理界面CSV批量导入鱼竿和饰品
- 后台管理功能增加了用户管理功能
- 后台管理功能增加了市场管理功能
- 补充了管理员命令 `/代理上线` 和 `/代理下线`。
- 新增了很多命令的别名
- 更好的卡池管理系统，支持高级货币和限时卡池
- 修复了鱼竿的数量加成没有生效的BUG。


![image](https://github.com/user-attachments/assets/4dd1a179-967f-4cb9-82a5-ca3754b80bb0)
![image](https://github.com/user-attachments/assets/c80550e6-86a2-4373-b593-a7e2a8d0ab6b)
![image](https://github.com/user-attachments/assets/b7fd24bc-c0fe-4cee-9431-41b38af665e6)

## 🎣 钓鱼游戏命令手册 🎣

提示：命令中的 [ID] 表示必填参数，<> 表示可选参数。

### 🎣 基础与核心玩法

| 命令 | 别名 | 描述 |
|---|---|---|
| `/注册` | - | 注册新用户 |
| `/钓鱼` | - | 进行一次钓鱼 |
| `/签到` | - | 每日签到 |
| `/自动钓鱼` | - | 开启/关闭自动钓鱼 |
| `/钓鱼区域 [ID]` | `/区域 [ID]` | 查看或切换钓鱼区域（需要通行证的区域会自动消耗） |
| `/钓鱼记录` | `/钓鱼日志`、`/钓鱼历史` | 查看最近钓鱼记录 |
| `/钓鱼帮助` | `/钓鱼菜单`、`/菜单` | 查看帮助菜单 |

### 🎒 背包与资产管理

| 命令 | 别名 | 描述 |
|---|---|---|
| `/状态` | `/我的状态` | 查看个人详细状态 |
| `/背包` | `/查看背包`、`/我的背包` | 查看我的所有物品 |
| `/鱼塘` | - | 查看鱼塘中的所有鱼 |
| `/鱼塘容量` | - | 查看当前鱼塘容量 |
| `/升级鱼塘` | `/鱼塘升级` | 升级鱼塘容量 |
| `/鱼竿` | - | 查看我的鱼竿 |
| `/鱼饵` | - | 查看我的鱼饵 |
| `/饰品` | - | 查看我的饰品 |
| `/道具` | `/我的道具`、`/查看道具` | 查看我的道具 |
| `/使用道具 [ID]` | - | 使用指定ID的道具（部分道具不可直接使用） |
| `/开启全部钱袋` | `/打开全部钱袋` | 一次性开启所有钱袋类道具 |
| `/出售道具 [ID] [数量]` | `/卖出道具 [ID] [数量]` | 出售指定ID和数量的道具 |
| `/使用鱼竿 [ID]` | `/装备鱼竿 [ID]` | 装备指定ID鱼竿 |
| `/使用鱼饵 [ID]` | `/装备鱼饵 [ID]` | 使用指定ID鱼饵 |
| `/使用饰品 [ID]` | `/装备饰品 [ID]` | 装备指定ID饰品 |
| `/精炼鱼竿 [ID]` | `/鱼竿精炼 [ID]` | 精炼指定ID鱼竿 |
| `/精炼饰品 [ID]` | `/饰品精炼 [ID]` | 精炼指定ID饰品 |
| `/精炼帮助` | `/精炼说明`、`/精炼` | 查看精炼系统详细说明 |
| `/锁定鱼竿 [ID]` | `/鱼竿锁定 [ID]` | 锁定指定ID鱼竿，防止被精炼、卖出、上架 |
| `/解锁鱼竿 [ID]` | `/鱼竿解锁 [ID]` | 解锁指定ID鱼竿，允许正常操作 |
| `/锁定饰品 [ID]` | `/饰品锁定 [ID]` | 锁定指定ID饰品，防止被精炼、卖出、上架 |
| `/解锁饰品 [ID]` | `/饰品解锁 [ID]` | 解锁指定ID饰品，允许正常操作 |
| `/金币` | - | 查看金币余额 |
| `/高级货币` | `/钻石`、`/星石` | 查看高级货币余额 |

### 🛒 商店与市场

| 命令 | 别名 | 描述 |
|---|---|---|
| `/全部卖出` | `/全部出售`、`/卖出全部`、`/出售全部`、`/清空鱼` | 一键卖出鱼塘所有鱼 |
| `/保留卖出` | `/保留出售`、`/卖出保留`、`/出售保留` | 卖出所有鱼但每种保留一条 |
| `/砸锅卖铁` | `/破产`、`/清空`、`/清仓` | 出售所有未锁定且未装备的鱼竿、饰品和全部鱼类 |
| `/出售稀有度 [1-5]` | `/稀有度出售 [1-5]`、`/出售星级 [1-5]` | 卖出指定稀有度的鱼 |
| `/出售鱼竿 [ID]` | `/卖出鱼竿 [ID]` | 出售指定ID鱼竿（按稀有度×精炼等级计价） |
| `/出售所有鱼竿` | `/出售全部鱼竿`、`/卖出所有鱼竿`、`/卖出全部鱼竿`、`/清空鱼竿` | 一键出售所有(非在用/非保护)鱼竿（逐件按新规则计价） |
| `/出售饰品 [ID]` | `/卖出饰品 [ID]`、`/卖饰品 [ID]`、`/卖掉饰品 [ID]` | 出售指定ID饰品（按稀有度×精炼等级计价） |
| `/出售所有饰品` | `/出售全部饰品`、`/卖出所有饰品`、`/卖出全部饰品`、`/清空饰品` | 一键出售所有(非在用/非保护)饰品（逐件按新规则计价） |
| `/商店 [商店ID]` | - | 查看商店列表或指定商店详情（支持多商店系统） |
| `/商店购买 [商店ID] [商品ID] [数量]` | - | 从指定商店购买商品（支持复杂成本机制） |
| `/市场` | - | 查看玩家交易市场 |
| `/上架鱼竿 [ID] [价格]` | - | 将鱼竿上架市场 |
| `/上架饰品 [ID] [价格]` | - | 将饰品上架市场 |
| `/上架道具 [ID] [价格]` | - | 将道具上架市场 |
| `/匿名上架鱼竿 [ID] [价格]` | `/匿名上架竿`、`/匿名挂竿` | 匿名上架鱼竿到市场 |
| `/匿名上架饰品 [ID] [价格]` | `/匿名上架饰`、`/匿名挂饰` | 匿名上架饰品到市场 |
| `/匿名上架道具 [ID] [价格]` | `/匿名上架物`、`/匿名挂物` | 匿名上架道具到市场 |
| `/购买 [ID]` | - | 从市场购买商品 |
| `/我的上架` | `/上架列表`、`/我的商品`、`/我的挂单` | 查看我上架的商品 |
| `/下架 [ID]` | - | 下架我的商品 |

### 💰 出售定价与配置（鱼竿/饰品）

- 系统回收价计算：`售价 = 基础价(按稀有度) × 精炼等级乘数`
- 适用范围：`/出售鱼竿`、`/出售饰品`、`/出售所有鱼竿`、`/出售所有饰品`
- 批量出售会跳过正在装备的物品

配置示例（位于插件运行时装配的 `game_config` 中）：

```json
{
  "sell_prices": {
    "rod": { "1": 100, "2": 500, "3": 2000, "4": 5000, "5": 10000 },
    "accessory": { "1": 100, "2": 500, "3": 2000, "4": 5000, "5": 10000 },
    "refine_multiplier": {
      "1": 1.0, "2": 1.6, "3": 3.0, "4": 6.0, "5": 12.0,
      "6": 25.0, "7": 55.0, "8": 125.0, "9": 280.0, "10": 660.0
    }
  }
}
```

- 你可以按需调整不同稀有度的基础价，或调整各精炼等级的乘数曲线（当前默认为递增、近指数型曲线，鼓励高精炼装备的投资回报）。
- 市场玩家间交易价格不受上述配置限制，由卖家自定。

### 🎭 匿名上架功能说明

- **匿名上架**：玩家可以选择匿名上架商品到市场，其他玩家将看到"🎭 匿名卖家"而不是真实昵称
- **神秘感**：增加市场交易的神秘感和趣味性，让交易更加有趣
- **隐私保护**：保护卖家隐私，避免因商品价格或质量引起的争议
- **使用方式**：使用`/匿名上架鱼竿`、`/匿名上架饰品`、`/匿名上架道具`命令
- **显示效果**：匿名商品在市场列表中显示为"🎭 匿名卖家"
- **功能限制**：匿名上架的商品仍然需要支付相同的手续费，其他功能与普通上架相同

### 🛒 全新商店系统说明（2.0版本）

- **多商店类型**：支持普通商店、高级商店、限时商店三种类型
- **复杂商品机制**：支持多种成本类型组合（金币、高级货币、鱼竿、饰品、道具）
- **成本分组系统**：支持复杂的成本组合逻辑，组内支持AND/OR关系
- **时间控制**：支持商店营业时间、每日营业时间、商品限时销售
- **限购机制**：支持每人限购、每日限购等购买限制
- **库存管理**：支持商品库存控制和销售统计
- **商品类型扩展**：支持鱼竿、饰品作为商店商品
- **Web管理**：管理员可通过Web界面管理商店和商品

#### 商店命令使用示例

```
/商店                    # 查看所有商店列表
/商店 1                  # 查看商店1的详情和商品
/商店购买 1 2 5          # 从商店1购买商品2，数量5个
```

### 🎫 通行证机制说明

- **智能通行证系统**：特定钓鱼区域需要持有对应通行证才能进入
- **自动消耗机制**：使用 `/钓鱼区域 [ID]` 切换区域时，如果该区域需要通行证，系统会自动消耗一个通行证
- **通行证道具**：通行证道具设置为不可直接使用，防止误操作消耗
- **区域配置**：管理员可通过Web后台或命令设置各区域的通行证要求
- **成本透明**：每个区域都会显示钓鱼消耗和通行证要求，帮助用户做出明智选择

### 🌟 稀有度系统说明（2.0版本）

- **扩展稀有度**：支持1-10星稀有度，打破传统5星限制
- **颜色映射**：新增6-10星稀有度专属颜色显示
  - 6星：深蓝色
  - 7星：紫色
  - 8星：金色
  - 9星：彩虹色
  - 10星：传说色（特殊效果）
- **图鉴显示**：鱼类图鉴中高稀有度鱼类使用对应颜色显示
- **背包显示**：装备背包中稀有度星级使用对应颜色

### 🎰 抽卡与概率玩法

| 命令 | 别名 | 描述 |
|---|---|---|
| `/抽卡 [卡池ID]` | `/抽奖 [卡池ID]` | 进行单次抽卡 |
| `/十连 [卡池ID]` | - | 进行十连抽卡 |
| `/查看卡池 [ID]` | `/卡池` | 查看卡池详情 |
| `/抽卡记录` | - | 查看我的抽卡记录 |
| `/擦弹 [金额]` | - | 进行擦弹游戏 (可填allin/halfin) |
| `/擦弹记录` | `/擦弹历史` | 查看我的擦弹记录 |

#### 擦弹功能优化（2.0版本）
- **消息格式优化**：简化擦弹结果消息，突出关键信息
- **抑制通知**：添加服务器级别抑制状态检查，避免消息刷屏
- **智能显示**：根据擦弹结果智能调整消息长度和内容

### 👥 社交功能

| 命令 | 别名 | 描述 |
|---|---|---|
| `/排行榜` | `/phb` | 查看金币排行榜 |
| `/偷鱼 [@用户]` | - | 偷取指定用户的一条鱼 |
| `/驱灵 [@用户]` | - | 驱散目标的海灵守护（需持有驱灵香） |
| `/查看称号` | `/称号` | 查看我拥有的称号 |
| `/使用称号 [ID]` | - | 装备指定ID称号 |
| `/查看成就` | `/成就` | 查看我的成就进度 |
| `/税收记录` | - | 查看我的税收记录 |
| `/鱼类图鉴` | `/图鉴` | 查看已解锁的鱼类图鉴 |

### ⚙️ 管理后台（管理员）

| 命令 | 别名 | 描述 |
|---|---|---|
| `/修改金币 [用户ID] [数量]` | - | 修改用户金币 |
| `/奖励金币 [用户ID] [数量]` | - | 奖励用户金币 |
| `/扣除金币 [用户ID] [数量]` | - | 扣除用户金币 |
| `/修改高级货币 [用户ID] [数量]` | - | 修改高级货币 |
| `/奖励高级货币 [用户ID] [数量]` | - | 奖励高级货币 |
| `/扣除高级货币 [用户ID] [数量]` | - | 扣除高级货币 |
| `/全体奖励金币 [数量]` | - | 给所有用户发放金币 |
| `/全体奖励高级货币 [数量]` | - | 给所有用户发放高级货币 |
| `/全体扣除金币 [数量]` | - | 从所有用户扣除金币 |
| `/全体扣除高级货币 [数量]` | - | 从所有用户扣除高级货币 |
| `/全体发放道具 [道具ID] [数量]` | - | 给所有用户发放指定道具（管理员） |
| `/给所有用户发放道具 [道具ID] [数量]` | - | 给所有注册用户发放指定道具（管理员） |
| `/开启钓鱼后台管理` | - | 启动 Web 管理后台（管理员） |
| `/关闭钓鱼后台管理` | - | 关闭 Web 管理后台（管理员） |
| `/代理上线 [用户ID]` | `/login [用户ID]` | 扮演指定用户，方便调试（管理员） |
| `/代理下线` | `/logout` | 结束扮演（管理员） |
| `/同步` | `/同步设定`, `/同步数据` | 从 initial_data.py 同步商店、道具等模板数据（管理员） |

---

## 👥 社区与贡献

### 🤝 如何贡献

我们欢迎各种形式的贡献！无论您是开发者、用户还是爱好者，都可以为项目做出贡献：

#### 对于开发者
- 🐛 **报告Bug**：在 [Issues](https://github.com/xxlemon-io/astrbot_plugin_fishing/issues) 中报告发现的问题
- 💡 **功能建议**：提出新功能想法和改进建议
- 🔧 **代码贡献**：提交 Pull Request 改进代码
- 📖 **文档完善**：帮助完善文档和注释

#### 对于用户
- ⭐ **Star支持**：给项目点个Star，让更多人看到
- 📝 **使用反馈**：分享使用体验和建议
- 🐛 **问题报告**：报告使用中遇到的问题
- 💬 **社区讨论**：参与社区讨论，分享使用技巧

### 📋 贡献指南

1. **Fork** 本仓库
2. 创建您的特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交您的更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 打开一个 **Pull Request**

### 📄 代码规范

- 遵循 Python PEP 8 代码规范
- 添加适当的注释和文档字符串
- 确保代码通过所有测试
- 提交信息使用清晰的中文描述

### 🏆 贡献者

感谢所有为这个项目做出贡献的开发者们！

<a href="https://github.com/xxlemon-io/astrbot_plugin_fishing/graphs/contributors">
  <img src="https://contrib.rocks/image?repo=xxlemon-io/astrbot_plugin_fishing" />
</a>

## 📞 支持与联系

- 🐛 **问题反馈**：[GitHub Issues](https://github.com/xxlemon-io/astrbot_plugin_fishing/issues)
- 💬 **讨论交流**：[GitHub Discussions](https://github.com/xxlemon-io/astrbot_plugin_fishing/discussions)
- 📧 **邮件联系**：通过 GitHub 个人资料联系

## 🙏 致谢与项目来源

本项目基于以下开源项目进行开发：

- **原始版本**：[@baa131/astrbot_plugin_fishing](https://github.com/baa131/astrbot_plugin_fishing) v1.0.0
- **基础版本**：[@tinkerbellqwq/astrbot_plugin_fishing](https://github.com/tinkerbellqwq/astrbot_plugin_fishing) v1.4.6

感谢原作者的贡献和开源精神，让我们能够在此基础上继续改进和完善这个项目。

## 📜 开源协议与法律声明

本项目基于 [AGPL-3.0](https://opensource.org/licenses/AGPL-3.0) 开源协议发布。

### 协议要点
- ✅ **商业使用**：允许商业使用
- ✅ **修改**：允许修改和分发
- ✅ **专利使用**：允许专利使用
- ✅ **私人使用**：允许私人使用
- ⚠️ **开源要求**：基于本项目的衍生作品必须同样开源
- ⚠️ **网络服务**：通过网络提供服务的衍生作品也必须开源

### 免责声明
- 本项目仅供学习和娱乐使用
- 使用者需自行承担使用风险
- 开发者不对任何直接或间接损失负责

---

<div align="center">

**如果这个项目对您有帮助，请给我们一个 ⭐ Star！**

Made with ❤️ by the AstrBot Fishing Plugin Community

</div>
